<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Website Builder</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --accent: #4cc9f0;
      --light: #f8f9fa;
      --dark: #212529;
      --success: #4bb543;
      --warning: #ffcc00;
      --danger: #dc3545;
      --gray: #6c757d;
      --border-radius: 8px;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      display: flex;
      height: 100vh;
      background-color: #f5f7fb;
      color: var(--dark);
      overflow: hidden;
    }
    #sidebar {
      width: 280px;
      background: linear-gradient(to bottom, #2d3047, #1a1c2f);
      padding: 20px;
      border-right: 1px solid #3a3e5c;
      overflow-y: auto;
      color: white;
      transition: var(--transition);
      z-index: 10;
      box-shadow: var(--shadow);
    }
    #sidebar.collapsed {
      width: 60px;
      padding: 20px 10px;
    }
    #sidebar.collapsed h3, 
    #sidebar.collapsed .btn-text {
      display: none;
    }
    #sidebar.collapsed .btn-icon {
      margin-right: 0;
    }
    #sidebar h3 {
      margin-bottom: 20px;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    #sidebar h3 i {
      cursor: pointer;
      font-size: 1.1rem;
      opacity: 0.7;
      transition: var(--transition);
    }
    #sidebar h3 i:hover {
      opacity: 1;
    }
    .sidebar-btn {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      padding: 12px 15px;
      margin: 8px 0;
      width: 100%;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.95rem;
    }
    .sidebar-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateX(5px);
    }
    .btn-icon {
      margin-right: 10px;
      font-size: 1.1rem;
    }
    .btn-text {
      flex: 1;
      text-align: left;
    }
    #canvas-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    #toolbar {
      background: white;
      padding: 15px 20px;
      border-bottom: 1px solid #eaeaea;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    #toolbar h2 {
      font-size: 1.5rem;
      color: var(--primary);
    }
    .toolbar-actions {
      display: flex;
      gap: 10px;
    }
    .toolbar-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: var(--border-radius);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: var(--transition);
    }
    .toolbar-btn:hover {
      background: var(--secondary);
    }
    .toolbar-btn.secondary {
      background: var(--light);
      color: var(--dark);
      border: 1px solid #ddd;
    }
    .toolbar-btn.secondary:hover {
      background: #e9ecef;
    }
    #canvas {
      flex: 1;
      padding: 30px;
      background: #f8f9fa;
      overflow-y: auto;
      position: relative;
    }
    .block {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: var(--border-radius);
      padding: 20px;
      margin: 15px 0;
      box-shadow: var(--shadow);
      transition: var(--transition);
      position: relative;
    }
    .block:hover {
      border-color: var(--accent);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }
    .block-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    .block-title {
      font-weight: 600;
      color: var(--primary);
      font-size: 1.1rem;
    }
    .block-actions {
      display: flex;
      gap: 5px;
    }
    .block-action {
      background: none;
      border: none;
      color: var(--gray);
      cursor: pointer;
      padding: 5px;
      border-radius: 4px;
      transition: var(--transition);
    }
    .block-action:hover {
      background: #f0f0f0;
      color: var(--dark);
    }
    .block-content {
      min-height: 50px;
    }
    .empty-canvas {
      text-align: center;
      padding: 60px 20px;
      color: var(--gray);
    }
    .empty-canvas i {
      font-size: 3rem;
      margin-bottom: 15px;
      opacity: 0.5;
    }
    .empty-canvas h3 {
      margin-bottom: 10px;
      font-weight: 500;
    }
    .empty-canvas p {
      max-width: 500px;
      margin: 0 auto;
      line-height: 1.6;
    }
    /* Block-specific styles */
    .header-block {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .header-block img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      border-radius: 8px;
    }
    .header-block h1 {
      margin: 0;
      font-size: 2rem;
    }
    .text-block p {
      line-height: 1.6;
      margin: 0;
    }
    .image-block img {
      max-width: 100%;
      height: auto;
      border-radius: var(--border-radius);
    }
    .image-text-block {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }
    .image-text-block img {
      max-width: 200px;
      height: auto;
      border-radius: var(--border-radius);
    }
    .image-text-block p {
      flex: 1;
      line-height: 1.6;
      margin: 0;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .gallery img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: var(--border-radius);
    }
    .carousel {
      display: flex;
      overflow-x: auto;
      gap: 15px;
      padding: 10px 0;
      scrollbar-width: thin;
    }
    .carousel img {
      height: 200px;
      width: auto;
      border-radius: var(--border-radius);
      flex-shrink: 0;
    }
    .embed-block iframe {
      width: 100%;
      height: 300px;
      border-radius: var(--border-radius);
    }
    .button-block a {
      display: inline-block;
    }
    .button-block button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: var(--border-radius);
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
    }
    .button-block button:hover {
      background: var(--secondary);
      transform: translateY(-2px);
    }
    .divider-h {
      border-top: 2px solid #e0e0e0;
      margin: 20px 0;
      height: 1px;
    }
    .divider-v {
      border-left: 2px solid #e0e0e0;
      height: 100px;
      margin: 0 20px;
    }
    .collapsible-block details {
      border: 1px solid #e0e0e0;
      border-radius: var(--border-radius);
      overflow: hidden;
    }
    .collapsible-block summary {
      padding: 15px;
      background: #f8f9fa;
      cursor: pointer;
      font-weight: 600;
    }
    .collapsible-block p {
      padding: 15px;
      margin: 0;
      line-height: 1.6;
    }
    .toc-block ul {
      padding-left: 20px;
    }
    .toc-block li {
      margin: 8px 0;
    }
    .toc-block a {
      color: var(--primary);
      text-decoration: none;
      transition: var(--transition);
    }
    .toc-block a:hover {
      color: var(--secondary);
      text-decoration: underline;
    }
    .social-buttons {
      display: flex;
      gap: 15px;
    }
    .social-buttons a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      text-decoration: none;
      transition: var(--transition);
    }
    .social-buttons a:hover {
      background: var(--secondary);
      transform: translateY(-3px);
    }
    /* Form controls */
    .input-group {
      margin: 15px 0;
    }
    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--dark);
    }
    .input-control {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: var(--transition);
    }
    .input-control:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.2);
    }
    .file-input {
      display: none;
    }
    .file-label {
      display: inline-block;
      background: #f0f0f0;
      padding: 8px 15px;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      border: 1px dashed #ccc;
      text-align: center;
      width: 100%;
    }
    .file-label:hover {
      background: #e9ecef;
    }
    .ai-prompt {
      background: linear-gradient(to right, #f093fb, #f5576c);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: var(--border-radius);
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
      font-weight: 600;
      transition: var(--transition);
    }
    .ai-prompt:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 100;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-body {
      padding: 20px;
    }
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    /* AI Image Styles */
    .ai-image-preview {
      width: 100%;
      max-width: 300px;
      height: 200px;
      background: #f0f0f0;
      border-radius: var(--border-radius);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 15px auto;
      overflow: hidden;
    }
    .ai-image-preview img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    .ai-style-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin: 15px 0;
    }
    .ai-style-option {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
    }
    .ai-style-option:hover {
      background: #f0f0f0;
    }
    .ai-style-option.selected {
      border-color: var(--primary);
      background: rgba(67, 97, 238, 0.1);
    }
    /* Responsive */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      #sidebar {
        width: 100%;
        height: auto;
        max-height: 200px;
        overflow-y: auto;
      }
      #sidebar.collapsed {
        width: 100%;
        height: 60px;
      }
      #canvas-container {
        height: calc(100vh - 200px);
      }
      #sidebar.collapsed + #canvas-container {
        height: calc(100vh - 60px);
      }
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h3>
      <span>Insert Blocks</span>
      <i class="fas fa-chevron-left" id="toggle-sidebar"></i>
    </h3>
    <button class="sidebar-btn" onclick="addHeader()">
      <i class="fas fa-heading btn-icon"></i>
      <span class="btn-text">Header (logo + text)</span>
    </button>
    <button class="sidebar-btn" onclick="addText()">
      <i class="fas fa-paragraph btn-icon"></i>
      <span class="btn-text">Text</span>
    </button>
    <button class="sidebar-btn" onclick="addAIText()">
      <i class="fas fa-robot btn-icon"></i>
      <span class="btn-text">AI Text</span>
    </button>
    <button class="sidebar-btn" onclick="addImage()">
      <i class="fas fa-image btn-icon"></i>
      <span class="btn-text">Image</span>
    </button>
    <button class="sidebar-btn" onclick="addImageWithText()">
      <i class="fas fa-images btn-icon"></i>
      <span class="btn-text">Image + Text</span>
    </button>
    <button class="sidebar-btn" onclick="addMultiImages()">
      <i class="fas fa-th btn-icon"></i>
      <span class="btn-text">Multiple Images</span>
    </button>
    <button class="sidebar-btn" onclick="addCarousel()">
      <i class="fas fa-sliders-h btn-icon"></i>
      <span class="btn-text">Image Carousel</span>
    </button>
    <button class="sidebar-btn" onclick="addEmbed()">
      <i class="fas fa-code btn-icon"></i>
      <span class="btn-text">Embed Code</span>
    </button>
    <button class="sidebar-btn" onclick="addButton()">
      <i class="fas fa-hand-pointer btn-icon"></i>
      <span class="btn-text">Interactive Button</span>
    </button>
    <button class="sidebar-btn" onclick="addDivider('h')">
      <i class="fas fa-grip-lines btn-icon"></i>
      <span class="btn-text">Horizontal Divider</span>
    </button>
    <button class="sidebar-btn" onclick="addDivider('v')">
      <i class="fas fa-grip-lines-vertical btn-icon"></i>
      <span class="btn-text">Vertical Divider</span>
    </button>
    <button class="sidebar-btn" onclick="addCollapsible()">
      <i class="fas fa-caret-square-down btn-icon"></i>
      <span class="btn-text">Collapsible Group</span>
    </button>
    <button class="sidebar-btn" onclick="addTOC()">
      <i class="fas fa-list btn-icon"></i>
      <span class="btn-text">Table of Contents</span>
    </button>
    <button class="sidebar-btn" onclick="addSocialButtons()">
      <i class="fas fa-share-alt btn-icon"></i>
      <span class="btn-text">Social Buttons</span>
    </button>
  </div>
  <div id="canvas-container">
    <div id="toolbar">
      <h2><i class="fas fa-magic"></i> Website Builder</h2>
      <div class="toolbar-actions">
        <button class="toolbar-btn secondary" onclick="toggleEditMode()">
          <i class="fas fa-edit"></i> Toggle Edit Mode
        </button>
        <button class="toolbar-btn" onclick="exportPage()">
          <i class="fas fa-download"></i> Export Page
        </button>
        <button class="toolbar-btn secondary" onclick="clearCanvas()">
          <i class="fas fa-trash"></i> Clear All
        </button>
      </div>
    </div>
    <div id="canvas">
      <div class="empty-canvas">
        <i class="fas fa-plus-circle"></i>
        <h3>Your canvas is empty</h3>
        <p>Start building your website by adding blocks from the sidebar. You can add text, images, buttons, and more with just a click.</p>
      </div>
    </div>
  </div>
  <!-- AI Text Modal -->
  <div class="modal" id="aiTextModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Generate AI Text</h3>
        <i class="fas fa-times close-modal" onclick="closeModal('aiTextModal')"></i>
      </div>
      <div class="modal-body">
        <div class="input-group">
          <label for="aiPrompt">Enter your text prompt:</label>
          <textarea id="aiPrompt" class="input-control" rows="4" placeholder="Describe the text you want to generate..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="toolbar-btn secondary" onclick="closeModal('aiTextModal')">Cancel</button>
        <button class="toolbar-btn" onclick="generateAIText()">Generate Text</button>
      </div>
    </div>
  </div>
  <!-- AI Image Modal -->
  <div class="modal" id="aiImageModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Generate AI Image</h3>
        <i class="fas fa-times close-modal" onclick="closeModal('aiImageModal')"></i>
      </div>
      <div class="modal-body">
        <div class="input-group">
          <label for="aiImagePrompt">Describe the image you want to generate:</label>
          <textarea id="aiImagePrompt" class="input-control" rows="3" placeholder="A futuristic cityscape at sunset with flying cars..."></textarea>
        </div>
        <div class="input-group">
          <label>Select image style:</label>
          <div class="ai-style-options">
            <div class="ai-style-option selected" data-style="realistic">Realistic</div>
            <div class="ai-style-option" data-style="artistic">Artistic</div>
            <div class="ai-style-option" data-style="minimal">Minimal</div>
            <div class="ai-style-option" data-style="abstract">Abstract</div>
          </div>
        </div>
        <div class="ai-image-preview">
          <i class="fas fa-image" style="font-size: 3rem; color: #ccc;"></i>
        </div>
      </div>
      <div class="modal-footer">
        <button class="toolbar-btn secondary" onclick="closeModal('aiImageModal')">Cancel</button>
        <button class="toolbar-btn" onclick="generateAIImage()">Generate Image</button>
      </div>
    </div>
  </div>
  <script>
    const canvas = document.getElementById('canvas');
    let editMode = false;
    let blockCount = 0;
    let currentImageBlock = null;
    // Toggle sidebar
    document.getElementById('toggle-sidebar').addEventListener('click', function() {
      document.getElementById('sidebar').classList.toggle('collapsed');
      this.classList.toggle('fa-chevron-left');
      this.classList.toggle('fa-chevron-right');
    });
    // Toggle edit mode
    function toggleEditMode() {
      editMode = !editMode;
      canvas.contentEditable = editMode;
      // Show/hide block controls
      document.querySelectorAll('.block-actions').forEach(actions => {
        actions.style.display = editMode ? 'flex' : 'none';
      });
      // Update toolbar button
      const editBtn = document.querySelector('.toolbar-actions button:first-child');
      editBtn.innerHTML = editMode ? 
        '<i class="fas fa-eye"></i> Preview Mode' : 
        '<i class="fas fa-edit"></i> Edit Mode';
    }
    // Clear canvas
    function clearCanvas() {
      if (confirm('Are you sure you want to clear the canvas? This cannot be undone.')) {
        canvas.innerHTML = '<div class="empty-canvas"><i class="fas fa-plus-circle"></i><h3>Your canvas is empty</h3><p>Start building your website by adding blocks from the sidebar. You can add text, images, buttons, and more with just a click.</p></div>';
        blockCount = 0;
      }
    }
    // Modal functions
    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'flex';
    }
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }
    // Add block with common structure
    function addBlock(type, content, className = '') {
      // Remove empty canvas message if it exists
      const emptyCanvas = document.querySelector('.empty-canvas');
      if (emptyCanvas) emptyCanvas.remove();
      blockCount++;
      const div = document.createElement('div');
      div.className = `block ${type}-block ${className}`;
      div.id = `block-${blockCount}`;
      div.innerHTML = `
        <div class="block-header">
          <div class="block-title">${type.charAt(0).toUpperCase() + type.slice(1)} Block</div>
          <div class="block-actions" style="display: ${editMode ? 'flex' : 'none'}">
            <button class="block-action" onclick="moveBlockUp(this.parentElement.parentElement)"><i class="fas fa-arrow-up"></i></button>
            <button class="block-action" onclick="moveBlockDown(this.parentElement.parentElement)"><i class="fas fa-arrow-down"></i></button>
            <button class="block-action" onclick="duplicateBlock(this.parentElement.parentElement)"><i class="fas fa-copy"></i></button>
            <button class="block-action" onclick="deleteBlock(this.parentElement.parentElement)"><i class="fas fa-trash"></i></button>
          </div>
        </div>
        <div class="block-content">
          ${content}
        </div>
      `;
      canvas.appendChild(div);
      return div;
    }
    // Block management functions
    function moveBlockUp(block) {
      const prev = block.previousElementSibling;
      if (prev) {
        block.parentNode.insertBefore(block, prev);
      }
    }
    function moveBlockDown(block) {
      const next = block.nextElementSibling;
      if (next) {
        block.parentNode.insertBefore(next, block);
      }
    }
    function duplicateBlock(block) {
      const clone = block.cloneNode(true);
      clone.id = `block-${++blockCount}`;
      block.parentNode.insertBefore(clone, block.nextSibling);
    }
    function deleteBlock(block) {
      if (confirm('Are you sure you want to delete this block?')) {
        block.remove();
        // Show empty canvas message if no blocks left
        if (canvas.children.length === 0) {
          canvas.innerHTML = '<div class="empty-canvas"><i class="fas fa-plus-circle"></i><h3>Your canvas is empty</h3><p>Start building your website by adding blocks from the sidebar. You can add text, images, buttons, and more with just a click.</p></div>';
        }
      }
    }
    // Block creation functions
    function addHeader() {
      const content = `
        <div class="header-block">
          <img src="https://via.placeholder.com/60" alt="Logo">
          <h1 contenteditable="true">Your Header Text</h1>
        </div>
        <div class="input-group">
          <label for="header-logo-upload">Upload Logo:</label>
          <input type="file" id="header-logo-upload" class="file-input" accept="image/*">
          <label for="header-logo-upload" class="file-label"><i class="fas fa-upload"></i> Choose Logo Image</label>
        </div>
        <div class="input-group">
          <label for="header-logo-url">Or enter image URL:</label>
          <input type="text" id="header-logo-url" class="input-control" placeholder="https://example.com/logo.png">
        </div>
        <button class="ai-prompt" onclick="openAIImageModal(this, 'header')"><i class="fas fa-robot"></i> Generate AI Logo</button>
      `;
      const block = addBlock('header', content);
      // Add event listeners
      const fileInput = block.querySelector('#header-logo-upload');
      const urlInput = block.querySelector('#header-logo-url');
      const img = block.querySelector('img');
      fileInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          img.src = URL.createObjectURL(this.files[0]);
        }
      });
      urlInput.addEventListener('blur', function() {
        if (this.value) {
          img.src = this.value;
        }
      });
    }
    function addText() {
      const content = '<p contenteditable="true">Start typing your text here. You can edit this directly or use the AI text generator for more creative content.</p>';
      addBlock('text', content);
    }
    function addAIText() {
      openModal('aiTextModal');
    }
    async function generateAIText() {
      const prompt = document.getElementById('aiPrompt').value;
      if (!prompt) {
        alert('Please enter a prompt');
        return;
      }
      try {
        const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(prompt)}`);
        const text = await response.text();
        const content = `<p contenteditable="true">${text}</p>`;
        addBlock('text', content);
        closeModal('aiTextModal');
        document.getElementById('aiPrompt').value = '';
      } catch (error) {
        console.error('Error generating AI text:', error);
        alert('Error generating text. Please try again.');
      }
    }
    function addImage() {
      const content = `
        <div class="image-block">
          <img src="https://via.placeholder.com/400x300" alt="Image" style="width: 100%; max-width: 400px;">
        </div>
        <div class="input-group">
          <label for="image-upload">Upload Image:</label>
          <input type="file" id="image-upload" class="file-input" accept="image/*">
          <label for="image-upload" class="file-label"><i class="fas fa-upload"></i> Choose Image</label>
        </div>
        <div class="input-group">
          <label for="image-url">Or enter image URL:</label>
          <input type="text" id="image-url" class="input-control" placeholder="https://example.com/image.jpg">
        </div>
        <button class="ai-prompt" onclick="openAIImageModal(this, 'image')"><i class="fas fa-robot"></i> Generate AI Image</button>
      `;
      const block = addBlock('image', content);
      // Add event listeners
      const fileInput = block.querySelector('#image-upload');
      const urlInput = block.querySelector('#image-url');
      const img = block.querySelector('img');
      fileInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          img.src = URL.createObjectURL(this.files[0]);
        }
      });
      urlInput.addEventListener('blur', function() {
        if (this.value) {
          img.src = this.value;
        }
      });
    }
    function addImageWithText() {
      const content = `
        <div class="image-text-block">
          <img src="https://via.placeholder.com/200x150" alt="Image">
          <p contenteditable="true">This is a sample text block next to an image. You can edit this text and replace the image as needed.</p>
        </div>
        <div class="input-group">
          <label for="image-text-upload">Upload Image:</label>
          <input type="file" id="image-text-upload" class="file-input" accept="image/*">
          <label for="image-text-upload" class="file-label"><i class="fas fa-upload"></i> Choose Image</label>
        </div>
        <div class="input-group">
          <label for="image-text-url">Or enter image URL:</label>
          <input type="text" id="image-text-url" class="input-control" placeholder="https://example.com/image.jpg">
        </div>
        <button class="ai-prompt" onclick="openAIImageModal(this, 'image-text')"><i class="fas fa-robot"></i> Generate AI Image</button>
      `;
      const block = addBlock('image-text', content);
      // Add event listeners
      const fileInput = block.querySelector('#image-text-upload');
      const urlInput = block.querySelector('#image-text-url');
      const img = block.querySelector('img');
      fileInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          img.src = URL.createObjectURL(this.files[0]);
        }
      });
      urlInput.addEventListener('blur', function() {
        if (this.value) {
          img.src = this.value;
        }
      });
    }
    function addMultiImages() {
      const content = `
        <div class="gallery"></div>
        <div class="input-group">
          <label for="gallery-upload">Upload Images:</label>
          <input type="file" id="gallery-upload" class="file-input" accept="image/*" multiple>
          <label for="gallery-upload" class="file-label"><i class="fas fa-upload"></i> Choose Multiple Images</label>
        </div>
        <div class="input-group">
          <label for="gallery-urls">Or enter image URLs (comma separated):</label>
          <input type="text" id="gallery-urls" class="input-control" placeholder="https://example.com/image1.jpg, https://example.com/image2.jpg">
        </div>
      `;
      const block = addBlock('gallery', content);
      const gallery = block.querySelector('.gallery');
      // Add event listeners
      const fileInput = block.querySelector('#gallery-upload');
      const urlInput = block.querySelector('#gallery-urls');
      fileInput.addEventListener('change', function() {
        gallery.innerHTML = '';
        if (this.files) {
          for (let file of this.files) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            gallery.appendChild(img);
          }
        }
      });
      urlInput.addEventListener('blur', function() {
        gallery.innerHTML = '';
        if (this.value) {
          const urls = this.value.split(',').map(url => url.trim());
          urls.forEach(url => {
            if (url) {
              const img = document.createElement('img');
              img.src = url;
              gallery.appendChild(img);
            }
          });
        }
      });
    }
    function addCarousel() {
      const content = `
        <div class="carousel"></div>
        <div class="input-group">
          <label for="carousel-upload">Upload Images:</label>
          <input type="file" id="carousel-upload" class="file-input" accept="image/*" multiple>
          <label for="carousel-upload" class="file-label"><i class="fas fa-upload"></i> Choose Multiple Images</label>
        </div>
      `;
      const block = addBlock('carousel', content);
      const carousel = block.querySelector('.carousel');
      // Add event listener
      const fileInput = block.querySelector('#carousel-upload');
      fileInput.addEventListener('change', function() {
        carousel.innerHTML = '';
        if (this.files) {
          for (let file of this.files) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            carousel.appendChild(img);
          }
        }
      });
    }
    function addEmbed() {
      const content = `
        <div class="embed-block">
          <iframe src="https://www.example.com" width="100%" height="300"></iframe>
        </div>
        <div class="input-group">
          <label for="embed-url">Enter embed URL or code:</label>
          <input type="text" id="embed-url" class="input-control" placeholder="https://www.youtube.com/embed/..." value="https://www.example.com">
        </div>
      `;
      const block = addBlock('embed', content);
      // Add event listener
      const urlInput = block.querySelector('#embed-url');
      const iframe = block.querySelector('iframe');
      urlInput.addEventListener('blur', function() {
        if (this.value) {
          iframe.src = this.value;
        }
      });
    }
    function addButton() {
      const content = `
        <div class="button-block">
          <a href="#"><button contenteditable="true">Click Me</button></a>
        </div>
        <div class="input-group">
          <label for="button-link">Button Link URL:</label>
          <input type="text" id="button-link" class="input-control" placeholder="https://example.com" value="#">
        </div>
      `;
      const block = addBlock('button', content);
      // Add event listener
      const linkInput = block.querySelector('#button-link');
      const link = block.querySelector('a');
      linkInput.addEventListener('blur', function() {
        if (this.value) {
          link.href = this.value;
        }
      });
    }
    function addDivider(type) {
      const content = type === 'h' ? 
        '<div class="divider-h"></div>' : 
        '<div class="divider-v"></div>';
      addBlock('divider', content);
    }
    function addCollapsible() {
      const content = `
        <div class="collapsible-block">
          <details>
            <summary>Click to expand</summary>
            <p contenteditable="true">This is the hidden content that appears when the collapsible section is expanded. You can edit this text as needed.</p>
          </details>
        </div>
      `;
      addBlock('collapsible', content);
    }
    function addTOC() {
      // This would normally scan the page for headings
      // For demo purposes, we'll create a mock TOC
      const content = `
        <div class="toc-block">
          <h3>Table of Contents</h3>
          <ul>
            <li><a href="#section1">Introduction</a></li>
            <li><a href="#section2">Features</a></li>
            <li><a href="#section3">How to Use</a></li>
            <li><a href="#section4">Examples</a></li>
            <li><a href="#section5">Conclusion</a></li>
          </ul>
        </div>
      `;
      addBlock('toc', content);
    }
    function addSocialButtons() {
      const content = `
        <div class="social-buttons">
          <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
          <a href="#" title="Facebook"><i class="fab fa-facebook"></i></a>
          <a href="#" title="Twitter"><i class="fab fa-twitter"></i></a>
          <a href="#" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
          <a href="#" title="GitHub"><i class="fab fa-github"></i></a>
        </div>
        <div class="input-group">
          <label>Set social media links:</label>
          <input type="text" class="input-control" placeholder="Instagram URL" onblur="this.parentElement.parentElement.querySelector('a:nth-child(1)').href=this.value">
          <input type="text" class="input-control" placeholder="Facebook URL" onblur="this.parentElement.parentElement.querySelector('a:nth-child(2)').href=this.value">
          <input type="text" class="input-control" placeholder="Twitter URL" onblur="this.parentElement.parentElement.querySelector('a:nth-child(3)').href=this.value">
          <input type="text" class="input-control" placeholder="LinkedIn URL" onblur="this.parentElement.parentElement.querySelector('a:nth-child(4)').href=this.value">
          <input type="text" class="input-control" placeholder="GitHub URL" onblur="this.parentElement.parentElement.querySelector('a:nth-child(5)').href=this.value">
        </div>
      `;
      addBlock('social', content);
    }
    // AI Image Functions
    function openAIImageModal(button, type) {
      currentImageBlock = {
        element: button.closest('.block'),
        type: type
      };
      // Reset modal
      document.getElementById('aiImagePrompt').value = '';
      document.querySelectorAll('.ai-style-option').forEach(option => {
        option.classList.remove('selected');
      });
      document.querySelector('.ai-style-option').classList.add('selected');
      openModal('aiImageModal');
    }
    function generateAIImage() {
      const prompt = document.getElementById('aiImagePrompt').value;
      if (!prompt) {
        alert('Please enter a prompt for the image');
        return;
      }
      const selectedStyle = document.querySelector('.ai-style-option.selected').dataset.style;
      // Show loading state
      const generateBtn = document.querySelector('#aiImageModal .toolbar-btn');
      const originalText = generateBtn.innerHTML;
      generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
      generateBtn.disabled = true;
      // Use Pollinations AI API
      const styleSeeds = {
        realistic: 'photo',
        artistic: 'art',
        minimal: 'minimal',
        abstract: 'abstract'
      };
      const seed = styleSeeds[selectedStyle] || 'default';
      const imgUrl = `https://pollinations.ai/p/${encodeURIComponent(prompt)}?seed=${seed}`;
      // Update the image in the block
      let imgElement;
      if (currentImageBlock.type === 'header') {
        imgElement = currentImageBlock.element.querySelector('.header-block img');
      } else if (currentImageBlock.type === 'image') {
        imgElement = currentImageBlock.element.querySelector('.image-block img');
      } else if (currentImageBlock.type === 'image-text') {
        imgElement = currentImageBlock.element.querySelector('.image-text-block img');
      }
      if (imgElement) {
        imgElement.src = imgUrl;
      }
      // Update preview in modal
      const preview = document.querySelector('.ai-image-preview');
      preview.innerHTML = `<img src="${imgUrl}" alt="AI Generated Image">`;
      // Reset button after a short delay to simulate processing
      setTimeout(() => {
        generateBtn.innerHTML = originalText;
        generateBtn.disabled = false;
        // Show success message
        alert('AI image generated successfully!');
      }, 1500);
    }
    // Style selection for AI images
    document.querySelectorAll('.ai-style-option').forEach(option => {
      option.addEventListener('click', function() {
        document.querySelectorAll('.ai-style-option').forEach(opt => {
          opt.classList.remove('selected');
        });
        this.classList.add('selected');
      });
    });
    function exportPage() {
      // Create a clean version of the page without editor controls
      const exportCanvas = document.createElement('div');
      exportCanvas.innerHTML = canvas.innerHTML;
      // Remove editor-specific elements
      exportCanvas.querySelectorAll('.block-header, .file-input, .file-label, .input-group, .ai-prompt').forEach(el => {
        el.remove();
      });
      // Make all content non-editable
      exportCanvas.querySelectorAll('[contenteditable="true"]').forEach(el => {
        el.removeAttribute('contenteditable');
      });
      // Create the full HTML document
      const styles = `
        <style>
          body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f8f9fa; 
            color: #212529; 
            line-height: 1.6; 
          }
          .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
          }
          .header-block { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            margin-bottom: 20px; 
          }
          .header-block img { 
            width: 60px; 
            height: 60px; 
            object-fit: contain; 
            border-radius: 8px; 
          }
          .header-block h1 { 
            margin: 0; 
            font-size: 2rem; 
          }
          .image-block img { 
            max-width: 100%; 
            height: auto; 
            border-radius: 8px; 
          }
          .image-text-block { 
            display: flex; 
            gap: 20px; 
            align-items: flex-start; 
            margin: 20px 0; 
          }
          .image-text-block img { 
            max-width: 200px; 
            height: auto; 
            border-radius: 8px; 
          }
          .gallery { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
          }
          .gallery img { 
            width: 100%; 
            height: 150px; 
            object-fit: cover; 
            border-radius: 8px; 
          }
          .carousel { 
            display: flex; 
            overflow-x: auto; 
            gap: 15px; 
            padding: 10px 0; 
            margin: 20px 0; 
          }
          .carousel img { 
            height: 200px; 
            width: auto; 
            border-radius: 8px; 
            flex-shrink: 0; 
          }
          .embed-block iframe { 
            width: 100%; 
            height: 300px; 
            border-radius: 8px; 
            margin: 20px 0; 
          }
          .button-block a { 
            display: inline-block; 
            margin: 20px 0; 
          }
          .button-block button { 
            background: #4361ee; 
            color: white; 
            border: none; 
            padding: 12px 25px; 
            border-radius: 8px; 
            font-size: 1rem; 
            cursor: pointer; 
            transition: all 0.3s ease; 
          }
          .button-block button:hover { 
            background: #3f37c9; 
            transform: translateY(-2px); 
          }
          .divider-h { 
            border-top: 2px solid #e0e0e0; 
            margin: 20px 0; 
            height: 1px; 
          }
          .divider-v { 
            border-left: 2px solid #e0e0e0; 
            height: 100px; 
            margin: 0 20px; 
          }
          .collapsible-block details { 
            border: 1px solid #e0e0e0; 
            border-radius: 8px; 
            overflow: hidden; 
            margin: 20px 0; 
          }
          .collapsible-block summary { 
            padding: 15px; 
            background: #f8f9fa; 
            cursor: pointer; 
            font-weight: 600; 
          }
          .collapsible-block p { 
            padding: 15px; 
            margin: 0; 
          }
          .toc-block ul { 
            padding-left: 20px; 
          }
          .toc-block li { 
            margin: 8px 0; 
          }
          .toc-block a { 
            color: #4361ee; 
            text-decoration: none; 
          }
          .toc-block a:hover { 
            color: #3f37c9; 
            text-decoration: underline; 
          }
          .social-buttons { 
            display: flex; 
            gap: 15px; 
            margin: 20px 0; 
          }
          .social-buttons a { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            background: #4361ee; 
            color: white; 
            text-decoration: none; 
            transition: all 0.3s ease; 
          }
          .social-buttons a:hover { 
            background: #3f37c9; 
            transform: translateY(-3px); 
          }
        </style>
      `;
      const content = `<!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Exported Website</title>
          ${styles}
        </head>
        <body>
          <div class="container">
            ${exportCanvas.innerHTML}
          </div>
        </body>
        </html>`;
      const blob = new Blob([content], {type: 'text/html'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'my-website.html';
      a.click();
    }
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>